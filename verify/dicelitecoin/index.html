<!DOCTYPE html>
<html>
<head>
	<title>diceliteco.in Verifier</title>
	<link rel="stylesheet" href="../../css/bootstrap.css">
	<script src="../../js/jquery-1.11.0.min.js"></script>
	<script src="../../js/bootstrap.js"></script>
	<script src="../../js/hmac-sha512.js"></script>
	<meta charset="UTF-8">
</head>

<body>
	<div class="container">
	<br>
	<textarea class="form-control" id="cs" placeholder="Client Seed"></textarea>
	<br>
	<textarea class="form-control" id="n" placeholder="Nonce"></textarea>
	<br>
	<textarea class="form-control" id="sh" placeholder="Server hash"></textarea>
	<br>
	<span class="label label-danger">Save your server hash so that you can verify the hash matches the actual seed!</span>
	<br>
	<textarea class="form-control" id="ss" placeholder="Server seed"></textarea>
	<br>
	<button class="btn btn-default" id="verify">Verify</button>
	<br>
	<div id="results"></div>
	</div>

	<script>
	var check = function() {
		var cs = document.getElementById("cs").value;
		var n = document.getElementById("n").value;
		var sh = document.getElementById("sh").value;
		var ss = document.getElementById("ss").value;
		if (CryptoJS.hmac-sha512(ss) == sh){
			document.getElementById('results').innerHTML = "<div class='alert alert-success'>Server hash matches server seed</div>"
		} else {
			document.getElementById('results').innerHTML = "<div class='alert alert-danger'>Server hash does not match server seed!</div>"
		}
		var message = n + cs + n;
		console.log("Message = " + message);
		var key = n + ss + n;
		console.log("Key = " + key);
		var digest = CryptoJS.hmac-sha512(key + message);
		console.log("Digest = " + digest);
		fiveParts  = digest.match(/.{1,5}/g);
        threePart = fiveParts.pop();
        part = fiveParts.shift();
        var roll;
        while (part) {
            if (part.toInt(base=16) < 1000000) {
            	roll = part / 10000;
            	break;
            }
            part = fiveParts.shift();
        }
		document.getElementById("results").innerHTML = "<div class='alert alert-info'>Roll is "+roll+"</div>"
	}
	document.getElementById('verify').addEventListener('click', check);
	</script>
</body>
</html>