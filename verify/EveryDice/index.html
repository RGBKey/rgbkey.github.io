<!DOCTYPE html>
<html>
<head>
	<title>EveryDice Verifier</title>
	<link rel="stylesheet" href="../../css/bootstrap.css">
	<script src="../../js/jquery-1.11.0.min.js"></script>
	<script src="../../js/bootstrap.js"></script>
	<script src="../../js/sha512.js"></script>
	<meta charset="UTF-8">
</head>

<body>
	<div class="container">
	<br>
	<textarea class="form-control" id="cs" placeholder="Client seed"></textarea>
	<br>
	<textarea class="form-control" id="ssh" placeholder="Server seed hash"></textarea>
	<br>
	<textarea class="form-control" id="ss" placeholder="Server seed"></textarea>
	<br>
	<input class="form-control" id="sn" placeholder="Starting nonce (>=1)" type="number"></input>
	<br>
	<button class="btn btn-default" id="verify">Verify</button>
	<br>
	<br>
	<div id="results"></div>
	</div>

	<script>
	var check = function() {
		var cs = document.getElementById("cs").value;
		var ssh = document.getElementById("ssh").value;
		var ss = document.getElementById("ss").value;
		var sn = document.getElementById('sn').value;
		sn = parseInt(sn);

		if (CryptoJS.SHA512(ss) == ssh){
			println("<div class='alert alert-success'>Hash matches server seed!</div>");
		} else {
			println("<div class='alert alert-danger'>Warning: Hash does not match server seed!")
		}
		
		var hash = CryptoJS(sn + '-' + ss + cs + '-' + sn);
		println("Roll is "+doRoll(hash));
		
	}
	var println = function(s) {
		var results = document.getElementById("results");
		results.innerHTML = results.innerHTML + s + "<br>";
	}
	function doRoll(hash) {
		var s;
		var roll;
		var i = 0;
	 
		while (i < hash.length - 4) {
			s = hash.substr(i, 5);
 
			// 16^5-1 = 1048575
			roll = parseInt(s, 16);
	 
			if (roll < 1000000) return roll;
			i++;
		}
	}
	
			roll = parseInt(hash.substr(-4), 16);
			return roll;
	document.getElementById('verify').addEventListener('click', check);
	</script>
</body>
</html>