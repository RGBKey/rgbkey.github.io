<!DOCTYPE html>
<html>
<head>
	<title>EveryDice Verifier</title>
	<link rel="stylesheet" href="../../css/bootstrap.css">
	<script src="../../js/jquery-1.11.0.min.js"></script>
	<script src="../../js/bootstrap.js"></script>
	<script src="../../js/sha512.js"></script>
	<meta charset="UTF-8">
</head>

<body>
	<div class="container">
	<br>
	<textarea class="form-control" id="cs" placeholder="Client seed"></textarea>
	<br>
	<textarea class="form-control" id="ssh" placeholder="Server seed hash"></textarea>
	<br>
	<textarea class="form-control" id="ss" placeholder="Server seed"></textarea>
	<br>
	<input class="form-control" id="sn" placeholder="Starting nonce (>=1)" type="number"></input>
	<br>
	<input class="form-control" id="nb" placeholder="Number of Bets after nonce to verify (>=1)" type="number"></input>
	<br>
	<button class="btn btn-default" id="verify">Verify</button>
	<br>
	<div id="results"></div>
	</div>

	<script>
	var check = function() {
		var cs = document.getElementById("cs").value;
		var ssh = document.getElementById("ssh").value;
		var ss = document.getElementById("ss").value;
		var sn = document.getElementById('sn').value;
		sn = parseInt(sn);
		var nb = document.getElementById('nb').value;
		nb = parseInt(nb);

		if (CryptoJS.SHA512(ss) == ssh){
			println("<div class='alert alert-success'>Hash matches server seed!</div>");
		} else {
			println("<div class='alert alert-danger'>Warning: Hash does not match server seed!")
		}

		for(i = nb;i > 0;i--){
			var nonce = sn + i;
			console.log("Nonce is "+nonce);
			var hash = CryptoJS.SHA512(nonce + '-' + ss + cs + '-' + nonce);
			console.log("Hash is "+hash);
			var  j = 0
			var roll = "If you see this, there was an error"
			var converting = true;


			while(j < hash.length - 4 && converting){
				hash = hash.toString.substr(j,5);
				roll = parseInt(hash, 16);
				console.log("Roll is "+roll);
				if(roll < 1000000){
					println("Nonce #"+nonce+": "+roll/10000);
					converting = false;
				} else {
					j++;
				}
			}
			if(j === 124){
				roll = parseInt(hash.toString.substr(124, 4), 16);
				println("Nonce #"+nonce+": "+roll/10000);
			}
		}
		
	}
	var println = function(s) {
		var results = document.getElementById("results");
		results.innerHTML = results.innerHTML + s + "<br>";
	}
	document.getElementById('verify').addEventListener('click', check);
	</script>
</body>
</html>